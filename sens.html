
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreador de Cólera - Sensor Mobile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <!-- Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEyAiggQthZ3AibDKDY9UNBoypYYamKBo&libraries=places,visualization"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            margin: 0; 
            padding: 0;
            background: radial-gradient(ellipse at center, #0f172a 0%, #020617 70%, #000000 100%);
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            color: #e2e8f0;
        }
        
        .sensor-panel {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(34, 197, 94, 0.2);
            box-shadow: 
                0 0 20px rgba(34, 197, 94, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .sensor-panel:hover {
            border-color: rgba(34, 197, 94, 0.4);
            box-shadow: 
                0 0 30px rgba(34, 197, 94, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .glow-green {
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
            color: #22c55e;
        }
        
        .glow-red {
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            color: #ef4444;
        }
        
        .glow-yellow {
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.8);
            color: #fbbf24;
        }
        
        .glow-blue {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
            color: #3b82f6;
        }
        
        .glow-cyan {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
            color: #22d3ee;
        }
        
        .sensor-button {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.7));
            border: 2px solid rgba(34, 197, 94, 0.3);
            box-shadow: 
                0 0 15px rgba(34, 197, 94, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .sensor-button:hover:not(:disabled) {
            border-color: rgba(34, 197, 94, 0.6);
            box-shadow: 
                0 0 25px rgba(34, 197, 94, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .sensor-button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 
                0 0 20px rgba(34, 197, 94, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .sensor-button.primary {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.3));
            border-color: rgba(34, 197, 94, 0.8);
        }
        
        .sensor-button.danger {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.3));
            border-color: rgba(239, 68, 68, 0.8);
        }
        
        .sensor-button.danger:hover:not(:disabled) {
            border-color: rgba(239, 68, 68, 1);
            box-shadow: 
                0 0 25px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
                text-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
            }
            50% { 
                box-shadow: 0 0 40px rgba(34, 197, 94, 0.6);
                text-shadow: 0 0 20px rgba(34, 197, 94, 1);
            }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .scan-line {
            position: relative;
            overflow: hidden;
        }
        
        .scan-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.8), transparent);
            animation: scan 3s infinite;
        }
        
        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        #map {
            height: 300px;
            width: 100%;
            border-radius: 1rem;
            border: 2px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
            border: 1px solid rgba(34, 197, 94, 0.2);
            box-shadow: 
                0 0 15px rgba(34, 197, 94, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            border-color: rgba(34, 197, 94, 0.4);
            box-shadow: 
                0 0 25px rgba(34, 197, 94, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .sensor-input {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(34, 197, 94, 0.3);
            color: #e2e8f0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .sensor-input:focus {
            border-color: rgba(34, 197, 94, 0.8);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(34, 197, 94, 0.2);
            outline: none;
        }
        
        .sensor-input::placeholder {
            color: rgba(148, 163, 184, 0.7);
        }
        
        .digital-display {
            font-family: 'Orbitron', monospace;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active {
            background: radial-gradient(circle, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.8);
            animation: pulse 2s infinite;
        }
        
        .status-inactive {
            background: radial-gradient(circle, #64748b 0%, #475569 100%);
            box-shadow: 0 0 5px rgba(100, 116, 139, 0.3);
        }
        
        .status-danger {
            background: radial-gradient(circle, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.8);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            vertical-align: middle;
            filter: drop-shadow(0 0 5px currentColor);
        }
        
        .icon-lg {
            width: 24px;
            height: 24px;
        }
        
        .icon-xl {
            width: 32px;
            height: 32px;
        }
        
        .sensor-header {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
            border: 2px solid rgba(34, 197, 94, 0.4);
            position: relative;
        }
        
        .sensor-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.8), transparent);
            animation: scan 4s infinite;
        }
        
        .coords-display {
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            color: #22d3ee;
            text-shadow: 0 0 8px rgba(34, 211, 238, 0.6);
        }
        
        /* Estilos adicionais para o leitor biométrico */
        .biometric-sensor {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid rgba(59, 130, 246, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .biometric-sensor:hover {
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .biometric-scanning {
            border-color: rgba(59, 130, 246, 0.8);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .biometric-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0;
            background: rgba(59, 130, 246, 0.3);
            transition: height 0.2s ease;
        }
        
        .biometric-pulse {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.1);
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase Initialization
        const firebaseConfig = {
            apiKey: "AIzaSyBtnU84zOmm9mjwJNf7Sa7g4exGjUI_kj0",
            authDomain: "vigicolera.firebaseapp.com",
            databaseURL: "https://vigicolera-default-rtdb.firebaseio.com",
            projectId: "vigicolera",
            storageBucket: "vigicolera.firebasestorage.app",
            messagingSenderId: "443742285213",
            appId: "1:443742285213:web:ce5c8ef141c46ed2ccd374"
        };

        // Initialize Firebase
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // SVG Icons with glow effect
        const BiohazardIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v-.07zM17.9 17.39c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
            </svg>
        );

        const MapIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const ActivityIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
            </svg>
        );

        const UserIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const PlayIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5,3 19,12 5,21"></polygon>
            </svg>
        );

        const StopIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12"></rect>
            </svg>
        );

        const SendIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
            </svg>
        );

        const TrendingUpIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const FingerprintIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path>
                <path d="M18 21a6 6 0 0 0-12 0"></path>
            </svg>
        );

        const ColeraTracker = () => {
            const [map, setMap] = useState(null);
            const [markers, setMarkers] = useState([]);
            const [cases, setCases] = useState([]);
            const [location, setLocation] = useState(null);
            const [locationName, setLocationName] = useState('');
            const [isTracking, setIsTracking] = useState(false);
            const [watchId, setWatchId] = useState(null);
            const [status, setStatus] = useState('SISTEMA AGUARDANDO');
            const [lastSent, setLastSent] = useState(null);
            const [error, setError] = useState(null);
            const [caseData, setCaseData] = useState({
                agenteName: '',
                caseType: 'suspeito',
                severity: 'leve'
            });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [biometricStatus, setBiometricStatus] = useState('AGUARDANDO DIGITAL');
            const [isScanning, setIsScanning] = useState(false);
            const [scanProgress, setScanProgress] = useState(0);
            const mapRef = useRef(null);
            const scanTimeoutRef = useRef(null);

            // Initialize Google Map
            useEffect(() => {
                if (mapRef.current && !map) {
                    const newMap = new window.google.maps.Map(mapRef.current, {
                        center: { lat: -7.606145, lng: 15.054881 },
                        zoom: 14,
                        mapTypeId: 'hybrid',
                        styles: [
                            {
                                featureType: "poi",
                                stylers: [{ visibility: "off" }]
                            },
                            {
                                elementType: "geometry",
                                stylers: [{ color: "#212121" }]
                            },
                            {
                                elementType: "labels.icon",
                                stylers: [{ visibility: "off" }]
                            },
                            {
                                elementType: "labels.text.fill",
                                stylers: [{ color: "#757575" }]
                            },
                            {
                                elementType: "labels.text.stroke",
                                stylers: [{ color: "#212121" }]
                            }
                        ]
                    });
                    setMap(newMap);
                }
            }, []);

            // Get location name using Google Geocoding
            const getLocationName = (lat, lng) => {
                const geocoder = new window.google.maps.Geocoder();
                geocoder.geocode({ location: { lat, lng } }, (results, status) => {
                    if (status === "OK" && results[0]) {
                        setLocationName(results[0].formatted_address);
                    } else {
                        setLocationName("COORDENADAS DESCONHECIDAS");
                    }
                });
            };

            // Handle position changes
            const handlePositionChange = (position) => {
                if (!map) return;
                
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                // Center map on new position
                map.setCenter(pos);
                
                // Add marker for current location
                const marker = new window.google.maps.Marker({
                    position: pos,
                    map: map,
                    title: "Sensor Ativo",
                    icon: {
                        path: window.google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: "#22c55e",
                        fillOpacity: 1,
                        strokeWeight: 3,
                        strokeColor: "#16a34a"
                    }
                });
                
                // Add accuracy circle
                new window.google.maps.Circle({
                    strokeColor: "#22c55e",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: "#22c55e",
                    fillOpacity: 0.1,
                    map: map,
                    center: pos,
                    radius: position.coords.accuracy
                });
                
                // Get location name
                getLocationName(pos.lat, pos.lng);
                
                // Clear old markers
                markers.forEach(m => m.setMap(null));
                setMarkers([marker]);
                
                // Update location state
                setLocation({
                    lat: pos.lat,
                    lng: pos.lng,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date()
                });
            };

            // Start/stop tracking
            const startTracking = () => {
                if (navigator.geolocation) {
                    const id = navigator.geolocation.watchPosition(
                        (position) => {
                            handlePositionChange(position);
                            setStatus('SENSOR GPS ATIVO - RASTREANDO');
                        },
                        (error) => {
                            let errorMessage = '';
                            switch (error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = "ERRO: PERMISSÃO GPS NEGADA";
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = "ERRO: SINAL GPS INDISPONÍVEL";
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = "ERRO: TIMEOUT GPS";
                                    break;
                                default:
                                    errorMessage = "ERRO: FALHA NO SISTEMA GPS";
                                    break;
                            }
                            setError(errorMessage);
                            setStatus('SISTEMA EM FALHA');
                        },
                        { enableHighAccuracy: true }
                    );
                    setWatchId(id);
                    setIsTracking(true);
                }
            };

            const stopTracking = () => {
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    setWatchId(null);
                }
                setIsTracking(false);
                setStatus('RASTREAMENTO DESATIVADO');
            };

            // Get current location once
            const getCurrentLocation = () => {
                if (navigator.geolocation) {
                    setStatus('INICIANDO SCAN GPS...');
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            handlePositionChange(position);
                            setStatus('COORDENADAS ADQUIRIDAS');
                        },
                        (error) => {
                            let errorMessage = '';
                            switch (error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = "ERRO: PERMISSÃO GPS NEGADA";
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = "ERRO: SINAL GPS INDISPONÍVEL";
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = "ERRO: TIMEOUT GPS";
                                    break;
                                default:
                                    errorMessage = "ERRO: FALHA NO SISTEMA GPS";
                                    break;
                            }
                            setError(errorMessage);
                            setStatus('SISTEMA EM FALHA');
                        },
                        { enableHighAccuracy: true }
                    );
                }
            };

            // Load cases from Firebase
            useEffect(() => {
                const casesRef = database.ref('casos-colera');
                casesRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const casesArray = Object.entries(data).map(([id, caso]) => ({
                            id,
                            ...caso,
                            coordenadas: {
                                lat: parseFloat(caso.coordenadas.lat),
                                lng: parseFloat(caso.coordenadas.lng)
                            }
                        }));
                        setCases(casesArray);
                    }
                }, (err) => {
                    setError(`ERRO DATABASE: ${err.message}`);
                });
                
                return () => casesRef.off();
            }, []);

            // Add markers for cases
            useEffect(() => {
                if (!map) return;
                
                const caseMarkers = cases.map(caso => {
                    return new window.google.maps.Marker({
                        position: { lat: caso.coordenadas.lat, lng: caso.coordenadas.lng },
                        map: map,
                        title: `CASO ${caso.id}`,
                        icon: {
                            path: window.google.maps.SymbolPath.CIRCLE,
                            scale: 8,
                            fillColor: getStatusColor(caso.status),
                            fillOpacity: 1,
                            strokeWeight: 2,
                            strokeColor: "#ffffff"
                        }
                    });
                });
                
                return () => {
                    caseMarkers.forEach(marker => marker.setMap(null));
                };
            }, [map, cases]);

            const getStatusColor = (status) => {
                switch (status) {
                    case 'confirmado': return '#ef4444';
                    case 'suspeito': return '#fbbf24';
                    case 'pendente-analise': return '#3b82f6';
                    case 'descartado': return '#22c55e';
                    default: return '#64748b';
                }
            };

            // Calculate statistics
            const stats = {
                total: cases.length,
                confirmados: cases.filter(c => c.status === 'confirmado').length,
                suspeitos: cases.filter(c => c.tipoCaso === 'suspeito').length,
                pendentes: cases.filter(c => c.status === 'pendente-analise').length,
                descartados: cases.filter(c => c.status === 'descartado').length,
                severos: cases.filter(c => c.gravidade === 'grave' || c.gravidade === 'critico').length,
                moderados: cases.filter(c => c.gravidade === 'moderado').length,
                leves: cases.filter(c => c.gravidade === 'leve').length
            };

            // Submit case to Firebase
            const sendCaseToFirebase = async (lat, lng, caseInfo) => {
                setIsSubmitting(true);
                try {
                    const data = {
                        agente: caseInfo.agenteName.trim(),
                        dispositivo: "mobile-sensor",
                        tipoCaso: caseInfo.caseType,
                        gravidade: caseInfo.severity,
                        coordenadas: {
                            lat: lat.toString(),
                            lng: lng.toString(),
                            precisao: location?.accuracy || 0
                        },
                        timestamp: new Date().toISOString(),
                        dataHora: new Date().toLocaleString('pt-BR', { timeZone: 'Africa/Luanda' })
                    };

                    await database.ref('casos-colera').push(data);
                    setLastSent(new Date().toLocaleTimeString('pt-BR', { timeZone: 'Africa/Luanda' }));
                    setStatus('TRANSMISSÃO CONCLUÍDA');
                    setError(null);
                    if (navigator.vibrate) {
                        navigator.vibrate([100, 100, 50, 100]);
                    }
                    setCaseData({
                        agenteName: '',
                        caseType: 'suspeito',
                        severity: 'leve'
                    });
                } catch (err) {
                    setError(`ERRO TRANSMISSÃO: ${err.message}`);
                    setStatus('FALHA NA TRANSMISSÃO');
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                } finally {
                    setIsSubmitting(false);
                }
            };

            const registerCase = () => {
                if (!location) {
                    setError('ERRO: COORDENADAS NÃO DISPONÍVEIS');
                    return;
                }
                if (!caseData.agenteName.trim()) {
                    setError('ERRO: ID AGENTE OBRIGATÓRIO');
                    return;
                }
                setStatus('TRANSMITINDO DADOS...');
                sendCaseToFirebase(location.lat, location.lng, caseData);
            };

            // Biometric functions
            const startBiometricScan = () => {
                if (isScanning) return;
                
                setIsScanning(true);
                setBiometricStatus('DETECTANDO DIGITAL...');
                setScanProgress(0);
                
                // Simulate scan progress
                const interval = setInterval(() => {
                    setScanProgress(prev => {
                        const newProgress = prev + 10;
                        if (newProgress >= 100) {
                            clearInterval(interval);
                            completeBiometricScan();
                            return 100;
                        }
                        return newProgress;
                    });
                }, 200);
                
                scanTimeoutRef.current = interval;
            };

            const completeBiometricScan = () => {
                setBiometricStatus('DIGITAL CONFIRMADA');
                setIsScanning(false);
                
                // Auto-register case after successful scan
                setTimeout(() => {
                    if (location) {
                        setStatus('REGISTRO AUTOMÁTICO INICIADO');
                        const autoCaseData = {
                            agenteName: 'SCAN BIOMÉTRICO',
                            caseType: 'suspeito',
                            severity: 'leve'
                        };
                        sendCaseToFirebase(location.lat, location.lng, autoCaseData);
                    }
                }, 1000);
                
                // Reset after 3 seconds
                setTimeout(() => {
                    setBiometricStatus('AGUARDANDO DIGITAL');
                    setScanProgress(0);
                }, 3000);
            };

            const cancelBiometricScan = () => {
                if (scanTimeoutRef.current) {
                    clearInterval(scanTimeoutRef.current);
                }
                setIsScanning(false);
                setBiometricStatus('SCAN CANCELADO');
                setScanProgress(0);
                
                setTimeout(() => {
                    setBiometricStatus('AGUARDANDO DIGITAL');
                }, 2000);
            };

            // Clean up on unmount
            useEffect(() => {
                return () => {
                    if (scanTimeoutRef.current) {
                        clearInterval(scanTimeoutRef.current);
                    }
                };
            }, []);

            // Get initial location
            useEffect(() => {
                getCurrentLocation();
                return () => {
                    if (watchId) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                };
            }, []);

            return (
                <div className="min-h-screen p-4 space-y-4">
                    {/* Header */}
                    <div className="sensor-header rounded-2xl p-6 text-center slide-up scan-line">
                        <div className="flex items-center justify-center gap-3 mb-2">
                            <BiohazardIcon className="icon-xl glow-red" />
                            <h1 className="text-2xl font-bold glow-green" style={{fontFamily: 'Orbitron, monospace'}}>
                                CÓLERA SENSOR v2.1
                            </h1>
                        </div>
                        <p className="text-cyan-400 text-sm">SISTEMA MOBILE DE VIGILÂNCIA EPIDEMIOLÓGICA</p>
                        <div className="mt-4 flex items-center justify-center">
                            <span className={`status-indicator ${isTracking ? 'status-active' : 'status-inactive'}`}></span>
                            <span className="text-sm font-medium">{status}</span>
                        </div>
                    </div>

                    {/* Map Section */}
                    <div className="sensor-panel rounded-2xl p-4 slide-up">
                        <div className="flex items-center justify-between mb-3">
                            <h2 className="text-lg font-bold flex items-center gap-2">
                                <MapIcon className="glow-blue" />
                                MAPA DE CASOS
                            </h2>
                            <div className="coords-display">
                                {location ? `${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}` : '---, ---'}
                            </div>
                        </div>
                        <div id="map" ref={mapRef}></div>
                        <div className="mt-2 text-xs text-slate-400">
                            {locationName || 'Carregando localização...'}
                        </div>
                    </div>

                    {/* Tracking Controls */}
                    <div className="sensor-panel rounded-2xl p-4 slide-up">
                        <h2 className="text-lg font-bold mb-3 flex items-center gap-2">
                            <ActivityIcon className="glow-yellow" />
                            CONTROLE DE RASTREAMENTO
                        </h2>
                        <div className="flex gap-3">
                            <button 
                                onClick={startTracking}
                                disabled={isTracking}
                                className={`sensor-button primary flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${isTracking ? 'opacity-50' : ''}`}
                            >
                                <PlayIcon className="icon" />
                                INICIAR
                            </button>
                            <button 
                                onClick={stopTracking}
                                disabled={!isTracking}
                                className={`sensor-button danger flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${!isTracking ? 'opacity-50' : ''}`}
                            >
                                <StopIcon className="icon" />
                                PARAR
                            </button>
                            <button 
                                onClick={getCurrentLocation}
                                className="sensor-button flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2"
                            >
                                <MapIcon className="icon" />
                                ATUALIZAR
                            </button>
                        </div>
                    </div>

                    {/* Biometric Scanner */}
                    <div className="sensor-panel rounded-2xl p-4 slide-up">
                        <h2 className="text-lg font-bold mb-3 flex items-center gap-2">
                            <FingerprintIcon className="glow-blue" />
                            LEITOR BIOMÉTRICO
                        </h2>
                        
                        <div className="text-center mb-4">
                            <div 
                                className={`mx-auto w-32 h-32 rounded-full border-4 flex items-center justify-center cursor-pointer relative overflow-hidden ${isScanning ? 'border-blue-500/80 bg-blue-500/10 biometric-scanning' : 'border-blue-500/30'}`}
                                onClick={!isScanning ? startBiometricScan : cancelBiometricScan}
                            >
                                {isScanning && (
                                    <>
                                        <div 
                                            className="absolute bottom-0 left-0 right-0 bg-blue-500/30 transition-all duration-200"
                                            style={{ height: `${scanProgress}%` }}
                                        ></div>
                                        <StopIcon className="icon-xl glow-red" />
                                    </>
                                )}
                                {!isScanning && (
                                    <>
                                        <div className="absolute inset-0 flex items-center justify-center">
                                            <div className="w-24 h-24 rounded-full bg-blue-500/10 animate-pulse"></div>
                                        </div>
                                        <FingerprintIcon className="icon-xl glow-blue" />
                                    </>
                                )}
                            </div>
                            <div className={`mt-3 font-medium ${isScanning ? 'glow-blue' : 'text-blue-400'}`}>
                                {biometricStatus}
                            </div>
                            {isScanning && (
                                <div className="w-full bg-gray-700 rounded-full h-2.5 mt-3">
                                    <div 
                                        className="bg-blue-500 h-2.5 rounded-full transition-all duration-200" 
                                        style={{ width: `${scanProgress}%` }}
                                    ></div>
                                </div>
                            )}
                        </div>
                        
                        <div className="text-xs text-center text-slate-400 mt-2">
                            {isScanning 
                                ? "Coloque o dedo no sensor e aguarde a confirmação"
                                : "Clique no sensor para simular a leitura digital"}
                        </div>
                    </div>

                    {/* Case Registration */}
                    <div className="sensor-panel rounded-2xl p-4 slide-up">
                        <h2 className="text-lg font-bold mb-3 flex items-center gap-2">
                            <UserIcon className="glow-cyan" />
                            REGISTRO DE CASO
                        </h2>
                        <div className="space-y-3">
                            <div>
                                <label className="block text-sm font-medium mb-1">ID DO AGENTE</label>
                                <input
                                    type="text"
                                    value={caseData.agenteName}
                                    onChange={(e) => setCaseData({...caseData, agenteName: e.target.value})}
                                    placeholder="Digite seu identificador"
                                    className="sensor-input w-full p-3 rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">TIPO DE CASO</label>
                                <select
                                    value={caseData.caseType}
                                    onChange={(e) => setCaseData({...caseData, caseType: e.target.value})}
                                    className="sensor-input w-full p-3 rounded-lg"
                                >
                                    <option value="suspeito">Suspeito</option>
                                    <option value="confirmado">Confirmado</option>
                                    <option value="pendente-analise">Pendente Análise</option>
                                    <option value="descartado">Descartado</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">GRAVIDADE</label>
                                <select
                                    value={caseData.severity}
                                    onChange={(e) => setCaseData({...caseData, severity: e.target.value})}
                                    className="sensor-input w-full p-3 rounded-lg"
                                >
                                    <option value="leve">Leve</option>
                                    <option value="moderado">Moderado</option>
                                    <option value="grave">Grave</option>
                                    <option value="critico">Crítico</option>
                                </select>
                            </div>
                            <button
                                onClick={registerCase}
                                disabled={isSubmitting || !location}
                                className={`sensor-button primary w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${isSubmitting || !location ? 'opacity-50' : ''}`}
                            >
                                {isSubmitting ? (
                                    <span className="flex items-center gap-2">
                                        <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        ENVIANDO...
                                    </span>
                                ) : (
                                    <span className="flex items-center gap-2">
                                        <SendIcon className="icon" />
                                        REGISTRAR CASO
                                    </span>
                                )}
                            </button>
                            {lastSent && (
                                <div className="text-xs text-center text-green-400">
                                    Última transmissão: {lastSent}
                                </div>
                            )}
                            {error && (
                                <div className="text-xs text-center glow-red p-2 rounded-lg bg-red-900/30">
                                    {error}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Statistics */}
                    <div className="sensor-panel rounded-2xl p-4 slide-up">
                        <h2 className="text-lg font-bold mb-3 flex items-center gap-2">
                            <TrendingUpIcon className="glow-yellow" />
                            ESTATÍSTICAS
                        </h2>
                        <div className="stats-grid">
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">TOTAL CASOS</div>
                                <div className="text-2xl font-bold glow-green">{stats.total}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">CONFIRMADOS</div>
                                <div className="text-2xl font-bold glow-red">{stats.confirmados}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">SUSPEITOS</div>
                                <div className="text-2xl font-bold glow-yellow">{stats.suspeitos}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">PENDENTES</div>
                                <div className="text-2xl font-bold glow-blue">{stats.pendentes}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">DESCARTADOS</div>
                                <div className="text-2xl font-bold glow-green">{stats.descartados}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">GRAVES/CRÍTICOS</div>
                                <div className="text-2xl font-bold glow-red">{stats.severos}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">MODERADOS</div>
                                <div className="text-2xl font-bold glow-yellow">{stats.moderados}</div>
                            </div>
                            <div className="stat-card p-3 rounded-lg">
                                <div className="text-xs text-slate-400">LEVES</div>
                                <div className="text-2xl font-bold glow-green">{stats.leves}</div>
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <div className="text-center text-xs text-slate-500 mt-4">
                        SISTEMA DE VIGILÂNCIA EPIDEMIOLÓGICA - MINISTÉRIO DA SAÚDE<br />
                        v2.1 | {new Date().getFullYear()}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ColeraTracker />, document.getElementById('root'));
    </script>
</body>
</html>
